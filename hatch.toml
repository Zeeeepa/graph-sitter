[build.hooks.vcs]
dependencies = ["hatch-vcs>=0.4.0"]
version-file = "src/graph_sitter/__init__.py"
template = """
# coding: utf-8
# file generated by setuptools_scm
# don't change, don't track in version control
version = {version!r}
version_tuple = {version_tuple!r}
from graph_sitter.cli.sdk.decorator import function
from graph_sitter.core.codebase import Codebase
"""
[metadata]
allow-direct-references = true
[envs.hatch-build]
installer = "uv"

[[envs.hatch-build.matrix]]
tool = ["uv", "pip"]

[envs.hatch-build.overrides]
matrix.tool.installer = { value = "{matrix:tool}" }
matrix.tool.scripts = [
  { key = "pip", value = "{env:HATCH_UV} pip {args}", if = [
    "uv",
  ] },
]

[version]
source = "vcs"

[build.targets.wheel.hooks.cython]
dependencies = [
  "hatch-cython @ git+https://github.com/codegen-sh/hatch-cython.git",
  "cython>=3.0.11",
  "tree-sitter",
  "networkx",
]

[build.targets.wheel.hooks.cython.options]
src = "graph_sitter"
compile_args = [
  "-O3",
  { platforms = [
    "darwin",
  ], arch = "arm64", arg = "-mcpu=apple-m1" },
]
env = [
  { env = "CC", arg = "cc", platforms = [
    "linux",
  ] },
  { env = "CC", arg = "clang", platforms = [
    "darwin",
  ] },
]
# Optimize Cython compilation for better performance
cythonize_kwargs = { annotate = true, nthreads = 8, exclude_failures = false, cache = true }
compiled_sdist = true
compile_py = false
compile_parallel = true

[build.targets.wheel.hooks.cython.options.directives]
boundscheck = false
nonecheck = false
language_level = 3
binding = true
linetrace = true
embedsignature = true
profile = true
c_string_encoding = "default"
c_string_type = "unicode"

[build.targets.wheel.hooks.cython.options.files]
exclude = [
  "**/__init__.py",
  "**/code_generation",
  "**/skills",
  "**/codebase/factory",
  "**/guides",
  "**/testing",
  "**/codebase_graph_utils.py",
  "**/codegen_examples",
]

[build.targets.wheel]
macos-max-compat = false

[build]
packages = ["src/graph_sitter"]

[metadata.hooks.vcs.urls]
Homepage = "https://www.codegen.com/"
Repository = "https://github.com/codegen-sh/graph-sitter"
Download = "https://github.com/codegen-sh/graph-sitter/archive/{commit_hash}.zip"
Changelog = "https://graph-sitter.com/changelog/changelog"
Releasenotes = "https://github.com/codegen-sh/graph-sitter/releases"
Issues = "https://github.com/codegen-sh/graph-sitter/issues"
Documentation = "https://graph-sitter.com"
Playground = "https://www.codegen.sh/"

[build.targets.wheel.hooks.custom]
enable-by-default = false
path = "src/gsbuild/build.py"
require-runtime-dependencies = true
[envs.default]
installer = "uv"
